/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package com.mux.gradle.android.publication

import org.gradle.api.Plugin
import org.gradle.api.Project
import org.gradle.api.ProjectConfigurationException
import org.gradle.api.publish.maven.plugins.MavenPublishPlugin

/**
 * A simple 'hello world' plugin.
 */
class AndroidPublicationPlugin : Plugin<Project> {

  private lateinit var extension: AndroidPublicationPluginExtension
  private lateinit var project: Project

  override fun apply(project: Project) {
    this.project = project
    initExtension(project)

    if (!projectIsAndroidLibrary()) {
      project.logger.warn("AndroidPublicationPlugin:" +
              " Skipping project ${project.name} because the library plugin is not applied")
      return
    }

    project.plugins.apply(MavenPublishPlugin::class.java)
    processVariants()
  }

  // todo - processVariants
  // todo - declarePublications

  private fun processVariants() {

  }

  @Throws
  private fun projectIsAndroidLibrary(): Boolean {
    return project.plugins.hasPlugin("com.android.library")
  }
  private fun initExtension(project: Project) {
    this.extension = project.extensions.create("muxLibrary", AndroidPublicationPluginExtension::class.java)
    extension.plugin = this
    extension.project = project
  }
}
